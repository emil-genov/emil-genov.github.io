---
layout: post
title: Exporting WebService - Using XFire with Spring
date: '2007-02-24T16:27:00.001+02:00'
tags: 
modified_time: '2007-02-24T16:38:46.038+02:00'
blogger_id: tag:blogger.com,1999:blog-7542889160674991776.post-5404802588224496862
blogger_orig_url: http://www.emil-genov.info/2007/02/exporting-webservice-using-xfire-with_2112.html
---

<p></p> <h2>Project structure and contents</h2> <p>Template project is attached to this page, feel free to use it and update it.  <p>As all Java WS are deployed as WAR file, at some point your project must create one. Here some guidelines how to have a one that works:  <ul> <li>In <b>WEB-INF/web.xml</b> file, XFireSpring servlet is instantiated. For it's parameter contextConfigLocation, we specify spring config file that will be discussed in next step. Mappings are usual one, this file is same as the one used for working of Spring with XFire:  <blockquote><pre>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;<br /><br />&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee"<br />	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br />	xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"<br />	version="2.4"&gt;<br /><br />	&lt;display-name&gt;XFire&lt;/display-name&gt;<br /><br />	&lt;context-param&gt;<br />		&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;                   (1)<br />		&lt;param-value&gt;classpath:xfire-servlet.xml&lt;/param-value&gt;<br />	&lt;/context-param&gt;<br /><br />	&lt;servlet&gt;<br />		&lt;servlet-name&gt;XFireServlet&lt;/servlet-name&gt;                        (2)<br />		&lt;display-name&gt;XFire Servlet&lt;/display-name&gt;<br />		&lt;servlet-class&gt;<br />			org.codehaus.xfire.spring.XFireSpringServlet<br />		&lt;/servlet-class&gt;<br />	&lt;/servlet&gt;<br /><br />	&lt;servlet-mapping&gt;<br />		&lt;servlet-name&gt;XFireServlet&lt;/servlet-name&gt;                        (3)<br />		&lt;url-pattern&gt;/servlet/XFireServlet/*&lt;/url-pattern&gt;<br />	&lt;/servlet-mapping&gt;<br /><br />	&lt;servlet-mapping&gt;<br />		&lt;servlet-name&gt;XFireServlet&lt;/servlet-name&gt;<br />		&lt;url-pattern&gt;/services/*&lt;/url-pattern&gt;<br />	&lt;/servlet-mapping&gt;<br /><br />	&lt;listener&gt;<br />		&lt;listener-class&gt;<br />			org.springframework.web.context.ContextLoaderListener    (4)<br />		&lt;/listener-class&gt;<br />	&lt;/listener&gt;<br /><br />&lt;/web-app&gt;</pre></blockquote><br /><ul><br /><li>(1) Defines that file <b>xfire-servlet.xml</b>, will be automatically available to Spring. Will define this in next section. <br /><li>(2) Define XFireServlet <br /><li>(3) Map it to <b>XXX/services/... path</b>, where <b>XXX</b> will be <b>WAR</b> name <br /><li>(4) Add context listener, so Spring will auto-load xfire-servlet.xml file, see <a href="http://www.springframework.org/docs/api/org/springframework/web/context/ContextLoaderListener.html">Spring documentation for more detail</a></li></ul></li></ul><br /><ul><br /><li>Create spring config file (I have named it <b>xfire-servlet.xml</b>) for configuring XFire services. Put it in classpath. <br /><blockquote><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd"&gt;<br />&lt;beans&gt;<br />	&lt;bean id="jaxbServiceFactory" class="org.codehaus.xfire.jaxb2.JaxbServiceFactory" /&gt;              (1)<br />	&lt;import resource="classpath:org/codehaus/xfire/spring/xfire.xml" /&gt;                               (2)<br />	&lt;import resource="classpath:webservices.xml" /&gt;                                                   (3)<br />&lt;/beans&gt;</pre></blockquote><br /><ul><br /><li>(1) Defines JaxbFactory that will be used by all service exporters <br /><li>(2) Includes XFire internal (in xfire.jar) spring configuration <br /><li>(3) Includes our spring configuration file, in which we will define our exporter/implementation class pairs, for each WS we want to build. This is discussed in next paragraph. </li></ul></li></ul><br /><ul><br /><li>Create spring config file (<b>webservice.xml</b>) for instantiation of service implementations and exporters: <br /><blockquote><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd"&gt;<br />&lt;beans&gt;<br />	&lt;bean id="XFireContractFirst" class="org.example.xfirecontractfirst.XfireContractFirstImpl" /&gt;	   (1)<br />	&lt;bean name="XFireContractFirstService" class="org.codehaus.xfire.spring.ServiceBean"&gt;              (2)<br />		&lt;property name="serviceBean" ref="XFireContractFirst" /&gt;<br />		&lt;property name="serviceClass" value="org.example.xfirecontractfirst.XfireContractFirst" /&gt; (3)<br />		&lt;property name="serviceFactory"&gt;&lt;ref bean="jaxbServiceFactory"/&gt;&lt;/property&gt;                (4)<br />	&lt;/bean&gt;<br />&lt;/beans&gt;</pre></blockquote><br /><ul><br /><li>(1) This is instantiation of WS implementation class <br /><li>(2) This is instantiation of exporter <br /><li>(3) Which has parameters of implementation bean and service interface <br /><li>(4) Must use JAXB2 binding in order to have interoperability with .Net clients </li></ul></li></ul><br /><ul><br /><li>In lib folder You should have following jars: <br /><ul><br /><li>xfire-all-1.2.4.jar <br /><li>xfire-jsr181-api-1.0-M1.jar <br /><li>activation.jar <br /><li>commons-logging-1.0.4.jar <br /><li>mail-1.4.jar <br /><li>jdom-1.0.jar <br /><li>stax-api-1.0.1.jar <br /><li>wsdl4j-1.5.2.jar <br /><li>wstx-asl-3.0.1.jar <br /><li>log4j-1.2.8.jar <br /><li>spring.jar <br /><li>XmlSchema-1.1.jar <br /><li>jaxb-api-2.0.jar <br /><li>jaxb-impl-2.0.1.jar <br /><li>jaxb-xjc-2.0.1.jar (only for generation of java classes from WSDL, not needed to be in WAR file, after that) </li></ul></li></ul><br /><ul><br /><li>If you gonna run under Java 1.4, make sure to remove annotations that wsgen have putted in java code generated from WSDL. Also remove xfire-jsr181-api-1.0-M1.jar from classpath. <br /><li>For creating WAR this ant code fragment could be used: <br /><blockquote><pre>&lt;war warfile="webservice.war" webxml="webcontent/web.xml"&gt;<br />	&lt;zipfileset dir="lib" prefix="WEB-INF/lib" /&gt;<br />	&lt;zipfileset dir="bin" prefix="WEB-INF/classes"/&gt;<br />&lt;/war&gt;</pre></blockquote></li></ul><br /><h2><a></a>&nbsp;</h2><br /><h2>Adding a new WS</h2><br /><p>Once you have all this plumbing code set in place, adding a new WS is just a song: <br /><ul><br /><li>Just create interface and implentation of service <br /><li>Create implementation and exporter beans in webservices.xml file </li></ul><br /><h2>&nbsp;</h2><br /><h2>Example project</h2><br /><p>All this can be seen in attached <a href="https://wiki.industria.com:8443/download/attachments/19592/ws-example.zip?version=1">example ws project</a>. Just unpack it, add needed libs (see for list up) from current (version &gt;= 1.2.4) XFire distribution, and run <b>ant</b> which will </p><br /><p>create WS implementation classes from WSDL, compile them and generates WAR file. Deploy this file to Application server and test deployed WS.</p>
