---
layout: post
title: Exporting WebService - Using XFire with Spring and JSR181 Annotations
date: '2007-02-24T15:44:00.001+02:00'
tags: 
modified_time: '2007-02-24T15:48:10.576+02:00'
blogger_id: tag:blogger.com,1999:blog-7542889160674991776.post-4722824117018617332
blogger_orig_url: http://www.emil-genov.info/2007/02/exporting-webservice-using-xfire-with_5058.html
---

<p><img height="16" alt="" src="https://wiki.industria.com:8443/images/icons/emoticons/forbidden.gif" width="16" align="absMiddle" border="0">&nbsp;<b>NOT WORKING</b> <br>This still does not work, look at <a href="http://jira.codehaus.org/browse/XFIRE-715?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel">Codehaus issue</a>, when this is resolved is worth trying again  <p>&nbsp;  <h2>Project structure and contents</h2> <p>Template project is attached to this page, feel free to use it and update it.  <p>As all Java WS are deployed as WAR file, at some point your project must create one. Here some guidelines how to have a one that works:  <ul> <li>In <b>WEB-INF/web.xml</b> file, XFireSpring servlet is instantiated. For it's parameter contextConfigLocation, we specify spring config file that will be discussed in next step. Mappings are usual one, this file is same as the one used for working of Spring with XFire:  <blockquote><pre>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;<br /><br />&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee"<br />	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br />	xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"<br />	version="2.4"&gt;<br /><br />	&lt;display-name&gt;XFire&lt;/display-name&gt;<br /><br />	&lt;context-param&gt;<br />		&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;                   (1)<br />		&lt;param-value&gt;classpath:xfire-servlet.xml&lt;/param-value&gt;<br />	&lt;/context-param&gt;<br /><br />	&lt;servlet&gt;<br />		&lt;servlet-name&gt;XFireServlet&lt;/servlet-name&gt;                        (2)<br />		&lt;display-name&gt;XFire Servlet&lt;/display-name&gt;<br />		&lt;servlet-class&gt;<br />			org.codehaus.xfire.spring.XFireSpringServlet<br />		&lt;/servlet-class&gt;<br />	&lt;/servlet&gt;<br /><br />	&lt;servlet-mapping&gt;<br />		&lt;servlet-name&gt;XFireServlet&lt;/servlet-name&gt;                        (3)<br />		&lt;url-pattern&gt;/servlet/XFireServlet/*&lt;/url-pattern&gt;<br />	&lt;/servlet-mapping&gt;<br /><br />	&lt;servlet-mapping&gt;<br />		&lt;servlet-name&gt;XFireServlet&lt;/servlet-name&gt;<br />		&lt;url-pattern&gt;/services/*&lt;/url-pattern&gt;<br />	&lt;/servlet-mapping&gt;<br /><br />	&lt;listener&gt;<br />		&lt;listener-class&gt;<br />			org.springframework.web.context.ContextLoaderListener    (4)<br />		&lt;/listener-class&gt;<br />	&lt;/listener&gt;<br /><br />&lt;/web-app&gt;</pre></blockquote><br /><ul><br /><li>(1) Defines that file <b>xfire-servlet.xml</b>, will be automatically available to Spring. Will define this in next section. <br /><li>(2) Define XFireServlet <br /><li>(3) Map it to <b>XXX/services/... path</b>, where <b>XXX</b> will be <b>WAR</b> name <br /><li>(4) Add context listener, so Spring will auto-load xfire-servlet.xml file, see <a href="http://www.springframework.org/docs/api/org/springframework/web/context/ContextLoaderListener.html">Spring documentation for more detail</a></li></ul></li></ul><br /><ul><br /><li>Create Spring file (I have named it <b>xfire-servlet.xml</b>) for configuring XFire services. Put it in classpath. <br /><blockquote><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd"&gt;<br />&lt;beans&gt;<br /><br />	&lt;bean id="webAnnotations"<br />		class="org.codehaus.xfire.annotations.jsr181.Jsr181WebAnnotations" /&gt;        (1)<br />	&lt;bean id="handlerMapping"<br />		class="org.codehaus.xfire.spring.remoting.Jsr181HandlerMapping"&gt;             (2)<br />		&lt;property name="typeMappingRegistry"&gt;<br />			&lt;ref bean="typeMappingRegistry" /&gt;<br />		&lt;/property&gt;<br />		&lt;property name="xfire"&gt;<br />			&lt;ref bean="xfire" /&gt;<br />		&lt;/property&gt;<br />		&lt;property name="webAnnotations"&gt;<br />			&lt;ref bean="webAnnotations" /&gt;<br />		&lt;/property&gt;<br />	&lt;/bean&gt;<br /><br />	&lt;bean<br />		class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"&gt;<br />		&lt;property name="urlMap"&gt;<br />			&lt;map&gt;<br />				&lt;entry key="/"&gt;<br />					&lt;ref bean="handlerMapping" /&gt;<br />				&lt;/entry&gt;<br />			&lt;/map&gt;<br />		&lt;/property&gt;<br />	&lt;/bean&gt;<br /><br />	&lt;bean id="typeMappingRegistry"<br />		class="org.codehaus.xfire.jaxb2.JaxbTypeRegistry"                            (3)<br />		init-method="createDefaultMappings" singleton="true"&gt;<br />	&lt;/bean&gt;<br /><br /><br />	&lt;import resource="classpath:org/codehaus/xfire/spring/xfire.xml" /&gt;                  (4)<br />	&lt;import resource="classpath:webservices.xml" /&gt;                                      (5)<br />&lt;/beans&gt;</pre></blockquote><br /><ul><br /><li>(1) Defines usage JSR 181 Anotations <br /><li>(2) Defines same for mapping <br /><li>(3) Defines usage of JAXB2. This is very important. Without it XFire will use AEGIS binding, which gives unpleasant effects of creating non-existent namespaces for schema element with unbounded type in WSDL <br /><li>(4) Includes xfire.xml spring configuration file residing in xfire-all.jar <br /><li>(5) Includes our own spring configuration file which defines all beans that will be exposed as service. The same will be done for every bean instantiated by Spring, that is JSR 181 anotated, so this file is not strictly needed, but is good to group all WS implementation beans instantiations in same configuration file. This is discussed in next paragraph. </li></ul></li></ul><br /><ul><br /><li>Create spring config file (<b>webservice.xml</b>) for instantiation of service implementations and exporters: <br /><blockquote><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd"&gt;<br />&lt;beans&gt;<br />        &lt;bean id="XfireContractFirst" class="org.example.xfirecontractfirst.XfireContractFirstImpl" /&gt; (1)<br />&lt;/beans&gt;</pre></blockquote><br /><p>(1) This is instantiation of WS implementation class, which must have <a href="http://ftpna2.bea.com/pub/downloads/JSR181-fr-1.pdf">JSR-181 Annotations</a> in it.</p><br /><li>In lib folder You should have following jars: <br /><ul><br /><li>xfire-all-1.2.2.jar <br /><li>xfire-jsr181-api-1.0-M1.jar <br /><li>activation.jar <br /><li>commons-logging-1.0.4.jar <br /><li>mailapi_1_3_1.jar <br /><li>jdom-1.0.jar <br /><li>stax-api-1.0.1.jar <br /><li>wsdl4j-1.5.1.jar <br /><li>wstx-lgpl-3.0.2.jar <br /><li>log4j-1.2.8.jar <br /><li>spring.jar </li></ul><br /><li>Make sure that server runs <b>Java 5</b>, because of use of annotations <br /><li>For creating WAR this ant code fragment could be used: <br /><blockquote><pre>&lt;war warfile="webservice.war" webxml="webcontent/web.xml"&gt;<br />	&lt;zipfileset dir="lib" prefix="WEB-INF/lib" /&gt;<br />	&lt;zipfileset dir="bin" prefix="WEB-INF/classes"/&gt;<br />&lt;/war&gt;</pre></blockquote></li></ul><br /><h2><a></a>&nbsp;</h2><br /><h2>Adding a new WS</h2><br /><p>Once you have all this plumbing code set in place, adding a new WS is just a song: <br /><ul><br /><li>Just create interface and implentation of service <br /><li>Annotate them with <a href="http://ftpna2.bea.com/pub/downloads/JSR181-fr-1.pdf">JSR-181 annotations</a> <br /><li>And add a line in webservices.xml file </li></ul><br /><p>It's simple as that <br /><p>&nbsp; <br /><h2><a></a>Example project</h2><br /><p>All this can be seen in attached <a href="https://wiki.industria.com:8443/download/attachments/19256/ws+with+jsr181+-+example.zip?version=1">example ws project</a>. Just unpack it, add needed libs (see for list up) from current (version &gt;= 1.2.4) XFire distribution, and run <b>ant</b> which will create WS implementation classes from WSDL, compile them and generates WAR file. Deploy this file to Application server and test deployed WS.</p>
